<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="1539.9px" style="width:1826px;height:1539px;" version="1.1" viewBox="0 0 1826 1539" width="1827px"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.7999999523162842"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.5999999046325684" dy="3.5999999046325684" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1)" height="1279.6593" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="149.4" y="80.4867"/><rect fill="#FFFFFF" filter="url(#f1)" height="27" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="279" y="106.7062"/><rect fill="#FFFFFF" filter="url(#f1)" height="1147.7812" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="390.15" y="212.3648"/><rect fill="#FFFFFF" filter="url(#f1)" height="303.3562" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="488.7" y="1056.7898"/><rect fill="#FFFFFF" filter="url(#f1)" height="661.4297" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="609.75" y="238.5844"/><rect fill="#FFFFFF" filter="url(#f1)" height="628.0101" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="614.25" y="272.0039"/><rect fill="#FFFFFF" filter="url(#f1)" height="375.7148" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="618.75" y="309.9234"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="623.25" y="347.843"/><rect fill="#FFFFFF" filter="url(#f1)" height="272.8758" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="623.25" y="412.7625"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="618.75" y="842.2945"/><rect fill="#FFFFFF" filter="url(#f1)" height="84.8391" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="976.05" y="600.7992"/><rect fill="#FFFFFF" filter="url(#f1)" height="58.6195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1108.35" y="627.0187"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1112.85" y="660.4383"/><rect fill="#FFFFFF" filter="url(#f1)" height="277.1367" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1241.55" y="1083.0093"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1246.05" y="1116.4289"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1246.05" y="1334.9461"/><rect fill="#FFFFFF" filter="url(#f1)" height="58.6195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1455.75" y="1236.607"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1460.25" y="1270.0265"/><rect fill="#FFFFFF" filter="url(#f1)" height="26.2195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1598.85" y="159.9258"/><rect fill="#ADD8E6" height="1535.8078" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="438.75" x="87.3" y="3.6"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88.2" x="262.575" y="14.4602">Main process</text><rect fill="#90EE90" height="1535.8078" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="506.7" x="527.85" y="3.6"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="731.7" y="14.4602">Server process</text><rect fill="#808080" height="1535.8078" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="481.95" x="1036.35" y="3.6"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="1214.325" y="14.4602">App Client process</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="153.9" x2="153.9" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="283.05" x2="283.05" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="394.65" x2="394.65" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="492.75" x2="492.75" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="614.25" x2="614.25" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="832.95" x2="832.95" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="980.55" x2="980.55" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1112.85" x2="1112.85" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1246.05" x2="1246.05" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1459.8" x2="1459.8" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1603.35" x2="1603.35" y1="52.5867" y2="1504.9406"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1754.55" x2="1754.55" y1="52.5867" y2="1504.9406"/><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="122.4" x="90.9" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="109.8" x="97.2" y="38.8151">Hook_StartActivity</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="122.4" x="90.9" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="109.8" x="97.2" y="1522.0362">Hook_StartActivity</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="80.1" x="241.65" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="67.5" x="247.95" y="38.8151">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="80.1" x="241.65" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="67.5" x="247.95" y="1522.0362">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="117" x="334.35" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="104.4" x="340.65" y="38.8151">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="117" x="334.35" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="104.4" x="340.65" y="1522.0362">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="54.9" x="463.95" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="42.3" x="470.25" y="38.8151">Activity</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="54.9" x="463.95" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="42.3" x="470.25" y="1522.0362">Activity</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="162" x="531.45" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="149.4" x="537.75" y="38.8151">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="162" x="531.45" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="149.4" x="537.75" y="1522.0362">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="172.8" x="744.75" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="160.2" x="751.05" y="38.8151">VPackageManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="172.8" x="744.75" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="160.2" x="751.05" y="1522.0362">VPackageManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="97.2" x="930.15" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="84.6" x="936.45" y="38.8151">ProviderCaller</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="97.2" x="930.15" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="84.6" x="936.45" y="1522.0362">ProviderCaller</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="142.2" x="1039.95" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="1046.25" y="38.8151">StubContentProvider</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="142.2" x="1039.95" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="1046.25" y="1522.0362">StubContentProvider</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="99" x="1194.75" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="1201.05" y="38.8151">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="99" x="1194.75" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="1201.05" y="1522.0362">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="105.3" x="1405.8" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="92.7" x="1412.1" y="38.8151">HCallbackHook</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="105.3" x="1405.8" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="92.7" x="1412.1" y="1522.0362">HCallbackHook</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="145.8" x="1528.65" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1534.95" y="38.8151">VRedirectActRequest</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="145.8" x="1528.65" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1534.95" y="1522.0362">VRedirectActRequest</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="132.3" x="1687.05" y="20.8195"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="119.7" x="1693.35" y="38.8151">VActRedirectResult</text><rect fill="#FEFECE" filter="url(#f1)" height="27.2672" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="132.3" x="1687.05" y="1504.0406"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="119.7" x="1693.35" y="1522.0362">VActRedirectResult</text><rect fill="#FFFFFF" filter="url(#f1)" height="1279.6593" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="149.4" y="80.4867"/><rect fill="#FFFFFF" filter="url(#f1)" height="27" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="279" y="106.7062"/><rect fill="#FFFFFF" filter="url(#f1)" height="1147.7812" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="390.15" y="212.3648"/><rect fill="#FFFFFF" filter="url(#f1)" height="303.3562" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="488.7" y="1056.7898"/><rect fill="#FFFFFF" filter="url(#f1)" height="661.4297" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="609.75" y="238.5844"/><rect fill="#FFFFFF" filter="url(#f1)" height="628.0101" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="614.25" y="272.0039"/><rect fill="#FFFFFF" filter="url(#f1)" height="375.7148" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="618.75" y="309.9234"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="623.25" y="347.843"/><rect fill="#FFFFFF" filter="url(#f1)" height="272.8758" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="623.25" y="412.7625"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="618.75" y="842.2945"/><rect fill="#FFFFFF" filter="url(#f1)" height="84.8391" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="976.05" y="600.7992"/><rect fill="#FFFFFF" filter="url(#f1)" height="58.6195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1108.35" y="627.0187"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1112.85" y="660.4383"/><rect fill="#FFFFFF" filter="url(#f1)" height="277.1367" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1241.55" y="1083.0093"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1246.05" y="1116.4289"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1246.05" y="1334.9461"/><rect fill="#FFFFFF" filter="url(#f1)" height="58.6195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1455.75" y="1236.607"/><rect fill="#FFFFFF" filter="url(#f1)" height="25.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1460.25" y="1270.0265"/><rect fill="#FFFFFF" filter="url(#f1)" height="26.2195" style="stroke: #A80036; stroke-width: 0.8999999761581421;" width="9" x="1598.85" y="159.9258"/><polygon fill="#A80036" points="138.6,76.8867,147.6,80.4867,138.6,84.0867,142.2,80.4867" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2.7" x2="144" y1="80.4867" y2="80.4867"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="44.1" x="9" y="76.0469">onHook</text><polygon fill="#A80036" points="268.2,103.1062,277.2,106.7062,268.2,110.3062,271.8,106.7062" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="158.4" x2="273.6" y1="106.7062" y2="106.7062"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="103.5" x="164.7" y="102.2665">resolveActivityInfo</text><polygon fill="#A80036" points="1588.05,156.3258,1597.05,159.9258,1588.05,163.5258,1591.65,159.9258" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="158.4" x2="1593.45" y1="159.9258" y2="159.9258"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="146.7" x="164.7" y="155.486">new VRedirectActRequest</text><polygon fill="#A80036" points="168.3,182.5453,159.3,186.1453,168.3,189.7453,164.7,186.1453" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 2.0,2.0;" x1="162.9" x2="1602.45" y1="186.1453" y2="186.1453"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="18.9" x="173.7" y="181.7055">req</text><polygon fill="#A80036" points="379.35,208.7648,388.35,212.3648,379.35,215.9648,382.95,212.3648" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="158.4" x2="384.75" y1="212.3648" y2="212.3648"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="122.4" x="164.7" y="207.925">redirectTargetActivity</text><polygon fill="#A80036" points="598.95,234.9844,607.95,238.5844,598.95,242.1844,602.55,238.5844" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="399.15" x2="604.35" y1="238.5844" y2="238.5844"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="122.4" x="405.45" y="234.1446">redirectTargetActivity</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="618.75" x2="661.05" y1="260.4234" y2="260.4234"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="661.05" x2="661.05" y1="260.4234" y2="272.1234"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="624.15" x2="661.05" y1="272.1234" y2="272.1234"/><polygon fill="#A80036" points="633.15,268.5234,624.15,272.1234,633.15,275.7234,629.55,272.1234" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="162.9" x="629.55" y="255.8641">redirectTargetActivityLocked</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="623.25" x2="665.55" y1="298.343" y2="298.343"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="665.55" x2="665.55" y1="298.343" y2="310.043"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="628.65" x2="665.55" y1="310.043" y2="310.043"/><polygon fill="#A80036" points="637.65,306.443,628.65,310.043,637.65,313.643,634.05,310.043" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="112.5" x="634.05" y="293.7836">startProcessLocked</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="632.25" x2="670.05" y1="340.7625" y2="340.7625"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="670.05" x2="670.05" y1="340.7625" y2="352.4625"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="633.15" x2="670.05" y1="352.4625" y2="352.4625"/><polygon fill="#A80036" points="642.15,348.8625,633.15,352.4625,642.15,356.0625,638.55,352.4625" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="147.6" x="638.55" y="336.2032">queryFreeStubForProcess</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="627.75" x2="670.05" y1="401.182" y2="401.182"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="670.05" x2="670.05" y1="401.182" y2="412.882"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="633.15" x2="670.05" y1="412.882" y2="412.882"/><polygon fill="#A80036" points="642.15,409.282,633.15,412.882,642.15,416.482,638.55,412.882" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="160.2" x="638.55" y="396.6227">performStartProcessLocked</text><polygon fill="#A80036" points="822.15,439.882,831.15,443.482,822.15,447.082,825.75,443.482" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="632.25" x2="827.55" y1="443.482" y2="443.482"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="128.7" x="638.55" y="439.0422">querySharedPackages</text><polygon fill="#A80036" points="642.15,466.1016,633.15,469.7016,642.15,473.3015,638.55,469.7016" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 2.0,2.0;" x1="636.75" x2="832.05" y1="469.7016" y2="469.7016"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="179.1" x="647.55" y="465.2618">sharedPackages : List&lt;String&gt;</text><polygon fill="#A80036" points="822.15,492.3211,831.15,495.9211,822.15,499.5211,825.75,495.9211" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="632.25" x2="827.55" y1="495.9211" y2="495.9211"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="131.4" x="638.55" y="491.4813">queryContentProviders</text><polygon fill="#A80036" points="642.15,518.5406,633.15,522.1406,642.15,525.7406,638.55,522.1406" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 2.0,2.0;" x1="636.75" x2="832.05" y1="522.1406" y2="522.1406"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="171" x="647.55" y="517.7008">providers : List&lt;ProviderInfo&gt;</text><polygon fill="#A80036" points="822.15,544.7601,831.15,548.3601,822.15,551.9601,825.75,548.3601" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="632.25" x2="827.55" y1="548.3601" y2="548.3601"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="108.9" x="638.55" y="543.9203">getSharedLibraries</text><polygon fill="#A80036" points="642.15,570.9797,633.15,574.5797,642.15,578.1797,638.55,574.5797" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 2.0,2.0;" x1="636.75" x2="832.05" y1="574.5797" y2="574.5797"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="160.2" x="647.55" y="570.1399">usesLibraries : List&lt;String&gt;</text><polygon fill="#A80036" points="965.25,597.1992,974.25,600.7992,965.25,604.3992,968.85,600.7992" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="632.25" x2="970.65" y1="600.7992" y2="600.7992"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="215.1" x="638.55" y="596.3594">call(MethodConstants.INIT_PROCESS)</text><polygon fill="#A80036" points="1097.55,623.4187,1106.55,627.0187,1097.55,630.6187,1101.15,627.0187" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="985.05" x2="1102.95" y1="627.0187" y2="627.0187"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="18.9" x="991.35" y="622.5789">call</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1121.85" x2="1159.65" y1="653.3578" y2="653.3578"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1159.65" x2="1159.65" y1="653.3578" y2="665.0578"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1122.75" x2="1159.65" y1="665.0578" y2="665.0578"/><polygon fill="#A80036" points="1131.75,661.4578,1122.75,665.0578,1131.75,668.6578,1128.15,665.0578" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="62.1" x="1128.15" y="648.7985">initProcess</text><polygon fill="#FBFB77" filter="url(#f1)" points="791.1,703.7578,791.1,807.2578,1165.5,807.2578,1165.5,712.7578,1156.5,703.7578,791.1,703.7578" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1156.5" x2="1156.5" y1="703.7578" y2="712.7578"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1165.5" x2="1156.5" y1="712.7578" y2="712.7578"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="351" x="796.5" y="719.118">StubContentProvider.java中定义了20个静态内部类C1到C20，都</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="330.3" x="796.5" y="732.7375">是StubContentProvider的子类。并且在AndroidManifest.xml</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="277.2" x="796.5" y="746.3571">中声明了process字段，与对应的StubActivity一致。</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="274.5" x="796.5" y="759.9766">VA的服务进程取出一个空的stubContentProvider，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="351" x="796.5" y="773.5961">借助Android ContentProvider机制，系统会创建一个新进程出来，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="355.5" x="796.5" y="787.2157">稍后被作为双开应用的容身之所。这个偷梁换柱的过程由VA服务进程</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="35.1" x="796.5" y="800.8352">完成。</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="627.75" x2="665.55" y1="835.214" y2="835.214"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="665.55" x2="665.55" y1="835.214" y2="846.914"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="628.65" x2="665.55" y1="846.914" y2="846.914"/><polygon fill="#A80036" points="637.65,843.314,628.65,846.914,637.65,850.514,634.05,846.914" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="117.9" x="634.05" y="830.6547">fetchStubActivityInfo</text><polygon fill="#A80036" points="624.15,896.414,615.15,900.014,624.15,903.614,620.55,900.014" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 2.0,2.0;" x1="618.75" x2="1754.1" y1="900.014" y2="900.014"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="184.5" x="629.55" y="895.5742">result = new VActRedirectResult</text><polygon fill="#FBFB77" filter="url(#f1)" points="7.2,911.8336,7.2,1029.7336,297.9,1029.7336,297.9,920.8336,288.9,911.8336,7.2,911.8336" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="288.9" x2="288.9" y1="911.8336" y2="920.8336"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="297.9" x2="288.9" y1="920.8336" y2="920.8336"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="245.7" x="12.6" y="927.1938">前面的步骤已经为双开应用创建了一个桩进程，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="228.6" x="12.6" y="940.8133">接下来在该进程里启动双开应用的Activity，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="231.3" x="12.6" y="954.4328">下面这一句对应的是onHook方法的最后一行</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="191.7" x="12.6" y="968.0524">return method.invoke(who, args);</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="195.3" x="12.6" y="981.6719">这里Activity.startActivity最终触发了</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="218.7" x="12.6" y="995.2914">ActivityThread.scheduleLaunchActivity</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="257.4" x="12.6" y="1008.911">这个过程中涉及到AMS(system_process进程)、</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="271.8" x="12.6" y="1022.5305">应用进程的交互，为了简化逻辑，省略AMS调用时序</text><polygon fill="#A80036" points="477.9,1053.1898,486.9,1056.7898,477.9,1060.3898,481.5,1056.7898" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="158.4" x2="483.3" y1="1056.7898" y2="1056.7898"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="68.4" x="164.7" y="1052.35">startActivity</text><polygon fill="#A80036" points="1230.75,1079.4093,1239.75,1083.0093,1230.75,1086.6093,1234.35,1083.0093" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="497.7" x2="1236.15" y1="1083.0093" y2="1083.0093"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="134.1" x="504" y="1078.5696">scheduleLaunchActivity</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1255.05" x2="1292.85" y1="1109.3484" y2="1109.3484"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1292.85" x2="1292.85" y1="1109.3484" y2="1121.0484"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1255.95" x2="1292.85" y1="1121.0484" y2="1121.0484"/><polygon fill="#A80036" points="1264.95,1117.4484,1255.95,1121.0484,1264.95,1124.6484,1261.35,1121.0484" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="192.6" x="1261.35" y="1104.7891">sendMessage(LAUNCH_ACTIVITY)</text><polygon fill="#FBFB77" filter="url(#f1)" points="1080,1159.7484,1080,1209.2484,1407.6,1209.2484,1407.6,1168.7484,1398.6,1159.7484,1080,1159.7484" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1398.6" x2="1398.6" y1="1159.7484" y2="1168.7484"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1407.6" x2="1398.6" y1="1168.7484" y2="1168.7484"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="280.8" x="1085.4" y="1175.1086">注意，这里被由于桩进程的ActivityThread.mH对象的</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="279" x="1085.4" y="1188.7281">mCallback已经被hook为HCallbackHook对象，因此</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="308.7" x="1085.4" y="1202.3477">这个消息接下来会走到HCallbackHook.handleMessage里</text><polygon fill="#A80036" points="1444.95,1233.007,1453.95,1236.607,1444.95,1240.207,1448.55,1236.607" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1250.55" x2="1450.35" y1="1236.607" y2="1236.607"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="90" x="1256.85" y="1232.1672">handleMessage</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1469.25" x2="1507.05" y1="1262.9461" y2="1262.9461"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1507.05" x2="1507.05" y1="1262.9461" y2="1274.6461"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1470.15" x2="1507.05" y1="1274.6461" y2="1274.6461"/><polygon fill="#A80036" points="1479.15,1271.0461,1470.15,1274.6461,1479.15,1278.2461,1475.55,1274.6461" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="121.5" x="1475.55" y="1258.3867">handleLaunchActivity</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1255.05" x2="1292.85" y1="1327.8656" y2="1327.8656"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1292.85" x2="1292.85" y1="1327.8656" y2="1339.5656"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1255.95" x2="1292.85" y1="1339.5656" y2="1339.5656"/><polygon fill="#A80036" points="1264.95,1335.9656,1255.95,1339.5656,1264.95,1343.1656,1261.35,1339.5656" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="121.5" x="1261.35" y="1323.3063">handleLaunchActivity</text><polygon fill="#FBFB77" filter="url(#f1)" points="1194.3,1378.2656,1194.3,1487.1656,1508.4,1487.1656,1508.4,1387.2656,1499.4,1378.2656,1194.3,1378.2656" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1499.4" x2="1499.4" y1="1378.2656" y2="1387.2656"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1508.4" x2="1499.4" y1="1387.2656" y2="1387.2656"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="295.2" x="1199.7" y="1393.6258">handleLaunchActivity里会将讲偷梁换柱的StubActivity</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="292.5" x="1199.7" y="1407.2453">再设置待双开应用需要的intent/component/pkgname/</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="210.6" x="1199.7" y="1420.8649">ClassLoader等等，接下来流程继续执行</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="276.3" x="1199.7" y="1434.4844">ActivityThread.handleLaunchActivity，创建真正的</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="246.6" x="1199.7" y="1448.1039">双开应用的Activity，并调用其onCreate方法。</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1203.3" y="1461.7234"/><text fill="#FF0000" font-family="sans-serif" font-size="16.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276.3" x="1199.7" y="1479.52">这样就启动了被双开应用的Activity</text></g></svg>